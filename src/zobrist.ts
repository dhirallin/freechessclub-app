import Chess from 'chess.js';

export function zobristHash(chess: Chess): Number {
    var hash = 0;
    const files = ['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h'];
    var index = 0;
    for(let file of files) {
        for(let rank = 1; rank <= 8; rank++) {
            var piece = chess.get(rank + file);
            hash ^= randPieces[(piece.color === 'w' ? piece.type.toUpperCase() : piece.type)][index];        
            index++;
        }
    }
    hash ^= (chess.turn() === 'b' ? randTurnColorBlack : 0);  
    var splitFen = chess.fen().split(' ');
    var castlingRights = splitFen[2];
    var enPassant = splitFen[3];
    for(let ch of castlingRights) {
        var r = randCastlingRights[ch];
        if(r)
            hash ^= r;
    }
    if(enPassant !== '-') 
        hash ^= randEnPassants[enPassant.charCodeAt(0) - 'a'.charCodeAt(0)];

    return hash;
}

const randPieces = {
    'p': [0x194b13, 0x0783de, 0x2ead82, 0x2d8ab8, 0x60f760, 0x9da2e3, 0x3c36dd, 0x12a331, 0x468048, 0xb6f89b, 0xc46482, 0xe257e5, 0x1fc7be, 0x93fbba, 0x7a3185, 0x224791, 0xe63c05, 0xaf0bea, 0xa597d1, 0x453898, 0xe80dd6, 0xf81860, 0x6f3e86, 0xfe944a, 0x1adf63, 0x9b8d0e, 0x6ba2e7, 0x22405b, 0xb3e4f1, 0xed1234, 0x083ec0, 0xc27312, 0x8e7d56, 0xe22a05, 0x59ae52, 0x9f3428, 0x6f7edb, 0x098479, 0x9fd599, 0x2f21a1, 0xdf2baa, 0x4ece21, 0x2d420f, 0x2fd8f2, 0x20ef6a, 0x23295a, 0x4741b4, 0xf3ec97, 0xfab196, 0xd7181b, 0xa64b99, 0xb1629f, 0x291332, 0xf093ae, 0x07dba1, 0xe6146c, 0x0ac5a9, 0x5866ed, 0x521084, 0x19dc1a, 0x052096, 0x3acafa, 0xa0d733, 0x516e0f],
    'r': [0x304c94, 0x9d51b5, 0x0236cd, 0x9217ee, 0x2df7a9, 0x97af10, 0x9b8844, 0xc0797b, 0x7516f0, 0x04c91f, 0x45d36c, 0x7748ae, 0xcf86dd, 0x61e7ff, 0x9f0cc4, 0x1da19d, 0xb24e7e, 0x1cad5b, 0xdd358c, 0x335349, 0xdcf754, 0x4f2c41, 0x1e21af, 0xce24dd, 0x8ff3ac, 0xb4f79b, 0xac1c5b, 0x0eca5a, 0xd978a6, 0xb61f6e, 0xacdd77, 0x4ae648, 0x3dc31b, 0x5e3262, 0xbeac5b, 0x284b79, 0x249e31, 0x9d0e05, 0x785991, 0x00e8e3, 0x38a8ea, 0x283270, 0x79f524, 0x5c69c8, 0xa04101, 0x689117, 0x07d69b, 0x1358e4, 0x63c296, 0x428234, 0xc63ca7, 0x76501f, 0xbccaf8, 0xc40b6c, 0x69caa6, 0x663259, 0x2c43ec, 0x340b84, 0x4cee70, 0xf693cb, 0x0782a5, 0x6c78f9, 0xc7f3f3, 0x12e731],
    'n': [0xed6a4e, 0x0695ac, 0x136365, 0xfe9961, 0x7f5bb7, 0xdad784, 0x9f0fde, 0x6a542c, 0x774fc1, 0x6dc3b4, 0x4b8efe, 0x10fd0a, 0x921131, 0x93b74c, 0xa3a81b, 0x5e46cc, 0x4e3c4b, 0x166102, 0x0cd6fa, 0xcb1e87, 0x999054, 0xe61317, 0x120532, 0x44ee35, 0xb083b9, 0x2b6053, 0x51643f, 0x3bcce4, 0x56c94c, 0xdc61bb, 0xb4759c, 0xba2ae5, 0x6a588c, 0x01e247, 0xf1942f, 0xfe6ee6, 0xce4b8f, 0x2aec58, 0x1218bd, 0x337db6, 0xbc36ab, 0x6a05d9, 0x5c74ad, 0xedea31, 0x25883d, 0x3c6521, 0x3595ca, 0x2437d4, 0xe91d3b, 0x548af9, 0x34d1d9, 0x43be9e, 0x0ca318, 0xca5aa7, 0x9b7506, 0xb4bf35, 0x4e3d4a, 0x6b852f, 0x229c58, 0x3c5fb0, 0xa4967f, 0x201583, 0x22aa45, 0x6601ee],
    'b': [0x89f52f, 0x8c9f46, 0x375b28, 0x816070, 0xef5706, 0x63de9e, 0x84deaa, 0x52ded3, 0x30f1f3, 0x8c8075, 0x6b43d1, 0xdbc8e2, 0xc9a3e2, 0x1d4aea, 0xa697f2, 0x480c87, 0x759117, 0xd502bb, 0x7e2f2d, 0x5d317b, 0xcb5bb3, 0x5a15f7, 0xf7c50c, 0xe35698, 0x390930, 0x6caa01, 0x4a57ce, 0xb1f77b, 0xeae4ee, 0xf64b0b, 0xfef5db, 0x880cd3, 0x76b6f8, 0x43bcd7, 0x09a11c, 0x244824, 0xe1acdf, 0xb2515a, 0x4b599c, 0xf19fe8, 0x005829, 0x77a20f, 0x29070c, 0x0aaad0, 0x4e400a, 0xeb0907, 0x3bf481, 0x2a4edb, 0xb5bf65, 0x385f45, 0x33dcb3, 0xd7457b, 0x7f3ce7, 0xd6692a, 0xc60516, 0x21d2b2, 0x40de9f, 0x09812e, 0xd45507, 0x02270b, 0x7b28f7, 0x8b3edd, 0x3c87e1, 0xe8281e],
    'q': [0x982ed8, 0xca653f, 0x273dda, 0xc8878a, 0xeed488, 0x2aab60, 0x1d8673, 0x02bc80, 0x7d8e0c, 0x411640, 0x0a4ea0, 0x9eca3f, 0x9bffb2, 0x498e26, 0xd86ddc, 0x309293, 0xbaa3a0, 0xa59a8c, 0x399ac0, 0xde3e84, 0x61c149, 0xa55198, 0xc5f7e2, 0x5320b8, 0x79d3a3, 0xddae4d, 0xbcbb0a, 0xb76d3d, 0xe4593f, 0xf26fbf, 0xfabb8b, 0x492666, 0x42f28f, 0x5221b6, 0xcf2c6d, 0xe521f0, 0xf51013, 0xa7dccd, 0x63bbf4, 0x23d349, 0xb94941, 0xa4cff4, 0xd81a31, 0x3a50ec, 0x66ae27, 0x9f0ac5, 0x497233, 0xb15e64, 0xc44b56, 0xc31325, 0x5478e6, 0x3d1835, 0xa09f59, 0x773901, 0x97936c, 0x7d3285, 0xd32d76, 0xda0064, 0x31f53e, 0x3f303b, 0x063a94, 0x43302c, 0x0503ca, 0x5c8c28],
    'k': [0x8d6b7e, 0xc3a94e, 0x2fc50a, 0xf8904a, 0xe8d0d8, 0xe01e59, 0x3ee38e, 0xf6d77e, 0xde7f30, 0x868119, 0x2cc98a, 0x667bdd, 0xfc3ad1, 0x0d8059, 0x7010e7, 0xcee5ad, 0x6fbfd1, 0x5ac3a3, 0x5508e8, 0xdbad2f, 0x5ae385, 0xd71610, 0xdc5adc, 0x673c00, 0x6f65f3, 0xf62b23, 0x64642d, 0x170de9, 0xfdf50f, 0x1748bb, 0x5f48e3, 0xed748b, 0x81f7b4, 0x4b631e, 0xbb5ce2, 0x701b85, 0x39a409, 0x59d1ae, 0x94a155, 0xb1fce6, 0x1690e0, 0xba4f38, 0xc14b82, 0x788dc2, 0x622465, 0xcf8c25, 0xa6c55a, 0xbd716f, 0x8337af, 0xab187f, 0xff45b5, 0x711522, 0x640cf3, 0x38da26, 0xa8849b, 0x93b856, 0x15f20c, 0x667879, 0xbe1f6f, 0x5cf785, 0x2fac0b, 0x71e454, 0x16bae0, 0xbcd9a7],
    'P': [0x4c5683, 0xe4a8f8, 0xa2c104, 0x1b4a66, 0x56043b, 0xefc735, 0x5779ef, 0xf4a13c, 0x4fd9c7, 0xc159da, 0x23414f, 0xa07a8e, 0x993974, 0xb6af1b, 0xeaa461, 0x71e7d6, 0x94f800, 0x1a8da7, 0xae8d1a, 0xbc7958, 0x1acfa4, 0xadc11c, 0xdfe976, 0x6b5de2, 0xe27b3e, 0x016f33, 0xb19a8c, 0x337595, 0xa89f1e, 0x98a072, 0x5a82d2, 0x9afbbc, 0x0796fd, 0xeaa23c, 0x9e1680, 0xe37f0f, 0xa947ff, 0x8d51c1, 0x8b500d, 0xd0dcc7, 0x0879d6, 0xbd1168, 0xaf0950, 0x5a244c, 0x7be76f, 0x004336, 0xcb51ed, 0x13d169, 0xf6a67e, 0x3f4d71, 0x1bfbc3, 0xb39137, 0x02c91d, 0xad364e, 0xaea022, 0xbb0305, 0x149de0, 0x44b485, 0xa13b93, 0x69bd89, 0x92b514, 0xc7a706, 0x808649, 0x6540ea],
    'R': [0x4356e1, 0x126a60, 0x0cc46a, 0xe5855b, 0xfcb106, 0x122972, 0x97f190, 0x407029, 0x25a927, 0x75e186, 0x9c9009, 0x47cec9, 0xb11458, 0xee4dd4, 0x51998e, 0x257a93, 0x29c6da, 0xa44f09, 0xe555ce, 0x17920e, 0xe0218c, 0xf74c4e, 0xebade9, 0x8d612f, 0xccb691, 0xccfec5, 0xf441a5, 0x31d586, 0x3140b5, 0x1de8c4, 0x054edc, 0x87874d, 0x3ed311, 0x8d8902, 0xce518e, 0xf07409, 0xa51815, 0x79bb6e, 0x2607a5, 0x7eb666, 0xb26fed, 0x0cbfa5, 0x8a33a6, 0x9265ae, 0xd5013d, 0xb0e94d, 0x5f30c4, 0x2ac005, 0x9bc105, 0x080441, 0x57c8f1, 0x546ca6, 0xaf9891, 0x712341, 0x847b98, 0x5ddf37, 0xed889e, 0x614721, 0x17907d, 0x05b282, 0x9fab77, 0x3ea907, 0x0085c9, 0xa0c1f9],
    'N': [0x9b5b8f, 0xb7604d, 0x27b57a, 0x6e170f, 0x18faa6, 0x46d20a, 0x1a591c, 0x333f36, 0xa65d73, 0xf8e534, 0x945a91, 0x3566ce, 0x6f3c9f, 0x502a24, 0x90e36d, 0x46f3d7, 0xed754e, 0xc0bb64, 0x1f47ba, 0xa3c97a, 0xe2d1c0, 0xc939cb, 0x2f1372, 0xe61958, 0x8796f6, 0x4cc174, 0xd95504, 0x71fbf3, 0xb1c01e, 0xdfdec8, 0xf59a4d, 0xf41875, 0x402ce2, 0x182fa3, 0x5582da, 0xe60dbd, 0xfc30f0, 0x280c88, 0x97527e, 0x96dd18, 0xcdd555, 0xe81c17, 0x1f1b1e, 0x027fcd, 0x75c39e, 0xb94d19, 0x3a98f9, 0xb692b2, 0x26e5bb, 0x88ee10, 0x0a5309, 0xa86954, 0x0f1115, 0x2c8209, 0xfe2c2d, 0xa62702, 0x899bd3, 0x707f8e, 0xd437b4, 0xe8243e, 0x5839ac, 0x7ecd03, 0xf2a2e1, 0x619663],
    'B': [0x1786fa, 0xf82da5, 0x69045b, 0x65e0dd, 0x2aa920, 0xe147b7, 0xee053e, 0xed456b, 0xcf8c55, 0xc056c3, 0x6d5284, 0xc6041e, 0xb9dff4, 0xc5e753, 0x8a9b51, 0x08c380, 0xa97ade, 0x671a35, 0x63e643, 0x7d9964, 0xc69bf9, 0x9c0342, 0x668288, 0x0b98e1, 0x70df4e, 0xb28c25, 0x075f83, 0xa8248e, 0x632139, 0xdb0a2a, 0x7dc277, 0xa5daf4, 0x319d99, 0xf9dbe6, 0x2b5d15, 0xcf5f22, 0x902564, 0x488b4e, 0x0fbb09, 0xb689eb, 0x25b73d, 0x712967, 0x1145cc, 0xf05779, 0x16baf3, 0xde915c, 0xf2705c, 0xc645bd, 0x545592, 0xc41614, 0x963d48, 0x68308c, 0xc23e8c, 0xf2a144, 0x22d5f0, 0xe9bffa, 0xae0860, 0x2d0cce, 0x32a3ab, 0x8f6777, 0x3a05d5, 0xf0a0ac, 0xe811b0, 0x9c3f35],
    'Q': [0x37815a, 0x29edc4, 0xc283c7, 0x4ce4c1, 0x43618d, 0x3d20c0, 0x918c19, 0xfd0a5e, 0x210280, 0x3c070d, 0xc74a9b, 0x0e1125, 0xd3af14, 0xf07d70, 0x47ddd4, 0x1e325f, 0xccfbb7, 0xc94d0c, 0x155ab8, 0x396e07, 0x4826ca, 0xe1d6bf, 0x31bc15, 0xc45574, 0xfabf80, 0xc10729, 0xafdccb, 0xe6bb15, 0xd82f8b, 0x6076d2, 0x0e8e17, 0x232dda, 0x8ee511, 0x40135b, 0x193bb7, 0xdcfed3, 0x26c749, 0xba6ca4, 0x812134, 0x6f13f0, 0x430103, 0x2e4af2, 0x33d7c2, 0x26c14a, 0x189548, 0x0229da, 0x311d26, 0x92a191, 0xdee8a2, 0x97b79b, 0xf3c355, 0x8fc561, 0xa54293, 0x6ea9f2, 0x4d2843, 0xdf5d2f, 0x855676, 0x1f0e1a, 0xd1c37c, 0xe9020e, 0xda861d, 0x05df2a, 0x6de7af, 0x7d8c10],
    'K': [0xd9f8ae, 0x030a00, 0x54d1eb, 0xb2f631, 0xbe970c, 0xfc9557, 0x3795c2, 0x4d667d, 0xc4c0db, 0x170ac9, 0x8798b8, 0x1710b9, 0xc6e064, 0xb4918e, 0x29fe28, 0x4ee29d, 0x158bb8, 0x515cc8, 0x120996, 0x3d584c, 0x3d00ce, 0xf44995, 0xfc660c, 0x58d852, 0x85de1a, 0x956fac, 0x746b3c, 0xd4d33e, 0x26a39b, 0x17096d, 0x05c7be, 0xe1f37d, 0xd2df82, 0x5df008, 0x1eeb1d, 0x5aedb4, 0x1cfc2c, 0x0d6aba, 0x7a11d4, 0x00289c, 0x1f5d6c, 0x464c24, 0x33d61a, 0xc5040b, 0x57e161, 0x966fda, 0xf4a6f8, 0x62d5d8, 0xa260ea, 0x221d83, 0x63232f, 0xb2539f, 0x7930d3, 0x01a8ad, 0x7ae4ba, 0xf7628b, 0x5bc147, 0x6df61f, 0x19887e, 0xf0f655, 0x32d493, 0x1b39df, 0x31bc2a, 0x04fe5c]
};
const randEnPassants = [0xd31df5, 0xf57504, 0xd85635, 0xe5d65b, 0x876a75, 0x7f690e, 0x97f5a6, 0x2fc47b];
const randCastlingRights = {'k': 0x7e1be7, 'q':  0x5356d6, 'K': 0x65ff0c, 'Q': 0xb44d3f};
const randTurnColorBlack = 0x5d24db;

