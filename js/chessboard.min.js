/*
 chessboard.js $version$

 Copyright 2013 Chris Oakman
 Released under the MIT license
 https://github.com/oakmac/chessboardjs/blob/master/LICENSE

 Date: $date$
*/
(function(){function l(f){return"string"!==typeof f?!1:-1!==f.search(/^[a-h][1-8]$/)}function T(f){if("string"!==typeof f)return!1;f=f.replace(/ .+$/,"");f=f.split("/");if(8!==f.length)return!1;for(var b=0;8>b;b++)if(""===f[b]||8<f[b].length||-1!==f[b].search(/[^kqrbnpKQRNBP1-8]/))return!1;return!0}function L(f){if("object"!==typeof f)return!1;for(var b in f)if(!0===f.hasOwnProperty(b)){var n;(n=!0!==l(b))||(n=f[b],n="string"!==typeof n?!1:-1!==n.search(/^[bw][KQRNBP]$/),n=!0!==n);if(n)return!1}return!0}
function M(f){if(!0!==T(f))return!1;f=f.replace(/ .+$/,"");f=f.split("/");for(var b={},n=8,m=0;8>m;m++){for(var l=f[m].split(""),t=0,x=0;x<l.length;x++)if(-1!==l[x].search(/[1-8]/))var J=parseInt(l[x],10),t=t+J;else{var J=C[t]+n,A;A=l[x];A=A.toLowerCase()===A?"b"+A.toUpperCase():"w"+A.toUpperCase();b[J]=A;t++}n--}return b}function N(f){if(!0!==L(f))return!1;for(var b="",n=8,m=0;8>m;m++){for(var l=0;8>l;l++){var t=C[l]+n;!0===f.hasOwnProperty(t)?(t=f[t].split(""),t="w"===t[0]?t[1].toUpperCase():t[1].toLowerCase(),
b+=t):b+="1"}7!==m&&(b+="/");n--}b=b.replace(/11111111/g,"8");b=b.replace(/1111111/g,"7");b=b.replace(/111111/g,"6");b=b.replace(/11111/g,"5");b=b.replace(/1111/g,"4");b=b.replace(/111/g,"3");return b=b.replace(/11/g,"2")}var C="abcdefgh".split("");window.ChessBoard=window.ChessBoard||function(f,b){function n(){return"xxxx-xxxx-xxxx-xxxx-xxxx-xxxx-xxxx-xxxx".replace(/x/g,function(a){return(16*Math.random()|0).toString(16)})}function m(a){return JSON.parse(JSON.stringify(a))}function ba(a){a=a.split(".");
return{major:parseInt(a[0],10),minor:parseInt(a[1],10),patch:parseInt(a[2],10)}}function t(a,c,e){if(!0===b.hasOwnProperty("showErrors")&&!1!==b.showErrors){var d="ChessBoard Error "+a+": "+c;"console"===b.showErrors&&"object"===typeof console&&"function"===typeof console.log?(console.log(d),2<=arguments.length&&console.log(e)):"alert"===b.showErrors?(e&&(d+="\n\n"+JSON.stringify(e)),window.alert(d)):"function"===typeof b.showErrors&&b.showErrors(a,c,e)}}function x(a){return"fast"===a||"slow"===a?
!0:parseInt(a,10)+""!==a+""?!1:0<=a}function J(){var a='<div class="'+h.chessboard+'">';!0===b.sparePieces&&(a+='<div class="'+h.sparePieces+" "+h.sparePiecesTop+'"></div>');a+='<div class="'+h.board+'"></div>';!0===b.sparePieces&&(a+='<div class="'+h.sparePieces+" "+h.sparePiecesBottom+'"></div>');return a+"</div>"}function A(a){"black"!==a&&(a="white");var c="",e=m(C),d=8;"black"===a&&(e.reverse(),d=1);for(var D="white",f=0;8>f;f++){for(var c=c+('<div class="'+h.row+'">'),k=0;8>k;k++){var g=e[k]+
d,c=c+('<div class="'+h.square+" "+h[D]+" square-"+g+'" style="width: '+r+"px; height: "+r+'px" id="'+u[g]+'" data-square="'+g+'">');if(!0===b.showNotation){if("white"===a&&1===d||"black"===a&&8===d)c+='<div class="'+h.notation+" "+h.alpha+'">'+e[k]+"</div>";0===k&&(c+='<div class="'+h.notation+" "+h.numeric+'">'+d+"</div>")}c+="</div>";D="white"===D?"black":"white"}c+='<div class="'+h.clearfix+'"></div></div>';D="white"===D?"black":"white";"white"===a?d--:d++}return c}function ca(){"wK wQ wR wB wN wP bK bQ bR bB bN bP".split(" ").forEach(function(a){var b=
new Image;b.onload=function(){var c=document.createElement("canvas");c.width=b.width;c.height=b.height;c.getContext("2d").drawImage(b,0,0);c=c.toDataURL("image/png");U[a]=c};b.src=V(a)})}function V(a){if(U[a])return U[a];"function"===typeof b.pieceTheme?a=b.pieceTheme(a):"string"===typeof b.pieceTheme?a=b.pieceTheme.replace(/{piece}/g,a):(t(8272,"Unable to build image source for cfg.pieceTheme."),a="");return a}function E(a,b,e){var c='<img src="'+V(a)+'" ';e&&"string"===typeof e&&(c+='id="'+e+'" ');
c+='alt="" class="'+h.piece+'" data-piece="'+a+'" style="width: '+r+"px;height: "+r+"px;";!0===b&&(c+="display:none;");return c+'" />'}function O(a){var b="wK wQ wR wB wN wP".split(" ");"black"===a&&(b="bK bQ bR bB bN bP".split(" "));a="";for(var e=0;e<b.length;e++)a+=E(b[e],!1,P[b[e]]);return a}function ka(a,c,e,d){a=$("#"+u[a]);var D=a.offset(),f=$("#"+u[c]);c=f.offset();var k=n();$("body").append(E(e,!0,k));var g=$("#"+k);g.css({display:"",position:"absolute",top:D.top,left:D.left});a.find("."+
h.piece).remove();g.animate(c,{duration:b.moveSpeed,complete:function(){f.append(E(e));g.remove();"function"===typeof d&&d()}})}function la(a,c,e){var d=$("#"+P[a]).offset(),f=$("#"+u[c]);c=f.offset();var g=n();$("body").append(E(a,!0,g));var k=$("#"+g);k.css({display:"",position:"absolute",left:d.left,top:d.top});k.animate(c,{duration:b.moveSpeed,complete:function(){f.find("."+h.piece).remove();f.append(E(a));k.remove();"function"===typeof e&&e()}})}function ma(a,c,e){function d(){f++;if(f===a.length&&
(G(),!0===b.hasOwnProperty("onMoveEnd")&&"function"===typeof b.onMoveEnd))b.onMoveEnd(m(c),m(e))}for(var f=0,g=0;g<a.length;g++)"clear"===a[g].type&&$("#"+u[a[g].square]+" ."+h.piece).fadeOut(b.trashSpeed,d),"add"===a[g].type&&!0!==b.sparePieces&&$("#"+u[a[g].square]).append(E(a[g].piece,!0)).find("."+h.piece).fadeIn(b.appearSpeed,d),"add"===a[g].type&&!0===b.sparePieces&&la(a[g].piece,a[g].square,d),"move"===a[g].type&&ka(a[g].source,a[g].destination,a[g].piece,d)}function na(a,b){a=a.split("");
var c=C.indexOf(a[0])+1,d=parseInt(a[1],10);b=b.split("");var g=C.indexOf(b[0])+1,f=parseInt(b[1],10),c=Math.abs(c-g),d=Math.abs(d-f);return c>=d?c:d}function oa(a){for(var b=[],e=0;8>e;e++)for(var d=0;8>d;d++){var g=C[e]+(d+1);a!==g&&b.push({square:g,distance:na(a,g)})}b.sort(function(a,b){return a.distance-b.distance});a=[];for(e=0;e<b.length;e++)a.push(b[e].square);return a}function G(){B.find("."+h.piece).remove();for(var a in g)!0===g.hasOwnProperty(a)&&(y&&p==a||$("#"+u[a]).append(E(g[a])))}
function Q(){B.html(A(v));G();!0===b.sparePieces&&("white"===v?(W.html(O("black")),X.html(O("white"))):(W.html(O("white")),X.html(O("black"))))}function R(a){var c=m(g),e=m(a),d=N(c),f=N(e);if(d!==f){if(!0===b.hasOwnProperty("onChange")&&"function"===typeof b.onChange)b.onChange(c,e);g=a}}function Y(a,b){for(var c in K)if(!0===K.hasOwnProperty(c)){var d=K[c];if(a>=d.left&&a<d.left+r&&b>=d.top&&b<d.top+r)return c}return"offboard"}function Z(){B.find("."+h.square).removeClass(h.highlight1+" "+h.highlight2)}
function pa(){if("spare"===p)da();else{Z();var a=$("#"+u[p]).offset();z.animate(a,{duration:b.snapbackSpeed,complete:function(){G();z.css("display","none");if(!0===b.hasOwnProperty("onSnapbackEnd")&&"function"===typeof b.onSnapbackEnd)b.onSnapbackEnd(F,p,m(g),v)}});y=!1}}function da(){Z();var a=m(g);delete a[p];R(a);G();z.fadeOut(b.trashSpeed);y=!1}function qa(a){if(0==H&&a===p)H=!0;else{H=!1;Z();var c=m(g);delete c[p];c[a]=F;R(c);c=$("#"+u[a]).offset();z.animate(c,{duration:b.snapSpeed,complete:function(){G();
z.css("display","none");if(!0===b.hasOwnProperty("onSnapEnd")&&"function"===typeof b.onSnapEnd)b.onSnapEnd(p,a,F)}});y=!1}}function S(a,c,e,d){if("function"!==typeof b.onDragStart||!1!==b.onDragStart(a,c,m(g),v)){y=!0;F=c;p=a;I="spare"===a?"offboard":a;K={};for(var f in u)!0===u.hasOwnProperty(f)&&(K[f]=$("#"+u[f]).offset());z.attr("src",V(c)).css({display:"",position:"absolute",left:e-r/2,top:d-r/2});"spare"!==a&&$("#"+u[a]).addClass(h.highlight1).find("."+h.piece).css("display","none")}}function ea(a,
c){z.css({left:a-r/2,top:c-r/2});var e=Y(a,c);if(e!==I){!0===l(I)&&$("#"+u[I]).removeClass(h.highlight2);!0===l(e)&&$("#"+u[e]).addClass(h.highlight2);if("function"===typeof b.onDragMove)b.onDragMove(e,I,p,F,m(g),v);I=e}}function fa(a){var c="drop";"offboard"===a&&"snapback"===b.dropOffBoard&&(c="snapback");"offboard"===a&&"trash"===b.dropOffBoard&&(c="trash");if(!0===b.hasOwnProperty("onDrop")&&"function"===typeof b.onDrop){var e=m(g);"spare"===p&&!0===l(a)&&(e[a]=F);!0===l(p)&&"offboard"===a&&delete e[p];
!0===l(p)&&!0===l(a)&&(delete e[p],e[a]=F);var d=m(g),e=b.onDrop(p,a,F,e,d,v);if("snapback"===e||"trash"===e)c=e}else if("spare"===p&&"offboard"===a){if(0==H){H=!0;return}H=!1}"snapback"===c?pa():"trash"===c?da():"drop"===c&&qa(a)}function ra(a){a.preventDefault()}function sa(a){if(!0===b.draggable){var c=$(this).attr("data-square");!0===l(c)&&!0===g.hasOwnProperty(c)&&S(c,g[c],a.pageX,a.pageY)}}function ta(a){if(!0===b.draggable){var c=$(this).attr("data-square");!0===l(c)&&!0===g.hasOwnProperty(c)&&
(a=a.originalEvent,S(c,g[c],a.changedTouches[0].pageX,a.changedTouches[0].pageY))}}function ua(a){if(!0===b.sparePieces){var c=$(this).attr("data-piece");S("spare",c,a.pageX,a.pageY)}}function va(a){if(!0===b.sparePieces){var c=$(this).attr("data-piece");a=a.originalEvent;S("spare",c,a.changedTouches[0].pageX,a.changedTouches[0].pageY)}}function ga(a){!0===y&&ea(a.pageX,a.pageY)}function wa(a){!0===y&&(a.preventDefault(),ea(a.originalEvent.changedTouches[0].pageX,a.originalEvent.changedTouches[0].pageY))}
function ha(a){!0===y&&(a=Y(a.pageX,a.pageY),fa(a))}function xa(a){!0===y&&(a=Y(a.originalEvent.changedTouches[0].pageX,a.originalEvent.changedTouches[0].pageY),fa(a))}function ya(a){if(!1===y&&!0===b.hasOwnProperty("onMouseoverSquare")&&"function"===typeof b.onMouseoverSquare&&(a=$(a.currentTarget).attr("data-square"),!0===l(a))){var c=!1;!0===g.hasOwnProperty(a)&&(c=g[a]);b.onMouseoverSquare(a,c,m(g),v)}}function za(a){if(!1===y&&!0===b.hasOwnProperty("onMouseoutSquare")&&"function"===typeof b.onMouseoutSquare&&
(a=$(a.currentTarget).attr("data-square"),!0===l(a))){var c=!1;!0===g.hasOwnProperty(a)&&(c=g[a]);b.onMouseoutSquare(a,c,m(g),v)}}b=b||{};var ia=M("rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR"),h={alpha:"alpha-d2270",black:"black-3c85d",board:"board-b72b1",chessboard:"chessboard-63f37",clearfix:"clearfix-7da63",highlight1:"highlight1-32417",highlight2:"highlight2-9c5d2",notation:"notation-322f9",numeric:"numeric-fc462",piece:"piece-417db",row:"row-5277c",sparePieces:"spare-pieces-7492f",sparePiecesBottom:"spare-pieces-bottom-ae20f",
sparePiecesTop:"spare-pieces-top-4028b",square:"square-55d63",white:"white-1e1d7"},w,B,z,W,X,q={},ja=2,v="white",g={},r,F,I,p,H=!1,y=!1,P={},u={},K,U={};q.clear=function(a){q.position({},a)};q.destroy=function(){w.html("");z.remove();w.unbind()};q.fen=function(){return q.position("fen")};q.flip=function(){return q.orientation("flip")};q.cache=ca;q.move=function(){if(0!==arguments.length){for(var a=!0,b={},e=0;e<arguments.length;e++)if(!1===arguments[e])a=!1;else{var d;d=arguments[e];"string"!==typeof d?
d=!1:(d=d.split("-"),d=2!==d.length?!1:!0===l(d[0])&&!0===l(d[1]));!0!==d?t(2826,"Invalid move passed to the move method.",arguments[e]):(d=arguments[e].split("-"),b[d[0]]=d[1])}var e=g,e=m(e),f;for(f in b)!0===b.hasOwnProperty(f)&&!0===e.hasOwnProperty(f)&&(d=e[f],delete e[f],e[b[f]]=d);b=e;q.position(b,a);return b}};q.orientation=function(a){if(0===arguments.length)return v;if("white"===a||"black"===a)return v=a,Q(),v;if("flip"===a)return v="white"===v?"black":"white",Q(),v;t(5482,"Invalid value passed to the orientation method.",
a)};q.position=function(a,b){if(0===arguments.length)return m(g);if("string"===typeof a&&"fen"===a.toLowerCase())return N(g);!1!==b&&(b=!0);"string"===typeof a&&"start"===a.toLowerCase()&&(a=m(ia));!0===T(a)&&(a=M(a));if(!0!==L(a))t(6482,"Invalid value passed to the position method.",a);else if(!0===b){var c=g,d=a,c=m(c),d=m(d),f=[],h={},k;for(k in d)!0===d.hasOwnProperty(k)&&!0===c.hasOwnProperty(k)&&c[k]===d[k]&&(delete c[k],delete d[k]);for(k in d)if(!0===d.hasOwnProperty(k)){var l;a:{l=c;for(var n=
d[k],q=oa(k),p=0;p<q.length;p++){var r=q[p];if(!0===l.hasOwnProperty(r)&&l[r]===n){l=r;break a}}l=!1}!1!==l&&(f.push({type:"move",source:l,destination:k,piece:d[k]}),delete c[l],delete d[k],h[k]=!0)}for(k in d)!0===d.hasOwnProperty(k)&&(f.push({type:"add",square:k,piece:d[k]}),delete d[k]);for(k in c)!0===c.hasOwnProperty(k)&&!0!==h.hasOwnProperty(k)&&(f.push({type:"clear",square:k,piece:c[k]}),delete c[k]);ma(f,g,a);R(a)}else R(a),G()};q.resize=function(){var a=parseInt(w.width(),10);if(!a||0>=a)r=
0;else{for(--a;0!==a%8&&0<a;)a--;r=a/8}B.css("width",8*r+"px");z.css({height:r,width:r});!0===b.sparePieces&&w.find("."+h.sparePieces).css("paddingLeft",r+ja+"px");Q()};q.start=function(a){q.position("start",a)};q.showNotation=function(a){b.showNotation=a;Q()};var aa;if(aa=!0===function(){if("string"===typeof f){if(""===f)return window.alert("ChessBoard Error 1001: The first argument to ChessBoard() cannot be an empty string.\n\nExiting..."),!1;var a=document.getElementById(f);if(!a)return window.alert('ChessBoard Error 1002: Element with id "'+
f+'" does not exist in the DOM.\n\nExiting...'),!1;w=$(a)}else if(w=$(f),1!==w.length)return window.alert("ChessBoard Error 1003: The first argument to ChessBoard() must be an ID or a single DOM node.\n\nExiting..."),!1;if(!window.JSON||"function"!==typeof JSON.stringify||"function"!==typeof JSON.parse)return window.alert("ChessBoard Error 1004: JSON does not exist. Please include a JSON polyfill.\n\nExiting..."),!1;if(a=typeof window.$&&$.fn&&$.fn.jquery)var a=$.fn.jquery,b="1.7.0",a=ba(a),b=ba(b),
a=!0===1E8*a.major+1E4*a.minor+a.patch>=1E8*b.major+1E4*b.minor+b.patch;return a?!0:(window.alert("ChessBoard Error 1005: Unable to find a valid version of jQuery. Please include jQuery 1.7.0 or higher on the page.\n\nExiting..."),!1)}()){if("string"===typeof b||!0===L(b))b={position:b};"black"!==b.orientation&&(b.orientation="white");v=b.orientation;!1!==b.showNotation&&(b.showNotation=!0);!0!==b.draggable&&(b.draggable=!1);"trash"!==b.dropOffBoard&&(b.dropOffBoard="snapback");!0!==b.sparePieces&&
(b.sparePieces=!1);!0===b.sparePieces&&(b.draggable=!0);if(!0!==b.hasOwnProperty("pieceTheme")||"string"!==typeof b.pieceTheme&&"function"!==typeof b.pieceTheme)b.pieceTheme="img/chesspieces/wikipedia/{piece}.png";if(!0!==b.hasOwnProperty("appearSpeed")||!0!==x(b.appearSpeed))b.appearSpeed=200;if(!0!==b.hasOwnProperty("moveSpeed")||!0!==x(b.moveSpeed))b.moveSpeed=200;if(!0!==b.hasOwnProperty("snapbackSpeed")||!0!==x(b.snapbackSpeed))b.snapbackSpeed=50;if(!0!==b.hasOwnProperty("snapSpeed")||!0!==x(b.snapSpeed))b.snapSpeed=
25;if(!0!==b.hasOwnProperty("trashSpeed")||!0!==x(b.trashSpeed))b.trashSpeed=100;!0===b.hasOwnProperty("position")&&("start"===b.position?g=m(ia):!0===T(b.position)?g=M(b.position):!0===L(b.position)?g=m(b.position):t(7263,"Invalid value passed to config.position.",b.position));aa=!0}aa&&(function(){for(var a=0;a<C.length;a++)for(var c=1;8>=c;c++){var e=C[a]+c;u[e]=e+"-"+n()}c="KQRBNP".split("");for(a=0;a<c.length;a++){var e="w"+c[a],d="b"+c[a];P[e]=e+"-"+n();P[d]=d+"-"+n()}ca();w.html(J());B=w.find("."+
h.board);!0===b.sparePieces&&(W=w.find("."+h.sparePiecesTop),X=w.find("."+h.sparePiecesBottom));a=n();$("body").append(E("wP",!0,a));z=$("#"+a);ja=parseInt(B.css("borderLeftWidth"),10);q.resize()}(),function(){$("body").on("mousedown mousemove","."+h.piece,ra);B.on("mousedown","."+h.square,sa);w.on("mousedown","."+h.sparePieces+" ."+h.piece,ua);B.on("mouseenter","."+h.square,ya).on("mouseleave","."+h.square,za);if(!0===(navigator&&navigator.userAgent&&-1!==navigator.userAgent.search(/MSIE/)))document.ondragstart=
function(){return!1},$("body").on("mousemove",ga).on("mouseup",ha);else $(window).on("mousemove",ga).on("mouseup",ha);!0==="ontouchstart"in document.documentElement&&(B.on("touchstart","."+h.square,ta),w.on("touchstart","."+h.sparePieces+" ."+h.piece,va),$(window).on("touchmove",wa).on("touchend",xa))}());return q};window.ChessBoard.fenToObj=M;window.ChessBoard.objToFen=N})();